# Dockerfile for HTTP/2 Slowloris Attack - Educational Lab
FROM python:3.11-slim

# Install system dependencies
RUN apt-get update && apt-get install -y \
    curl \
    netcat-openbsd \
    procps \
    && rm -rf /var/lib/apt/lists/*

# Set working directory
WORKDIR /app

# Copy the HTTP/2 slowloris attack script
COPY http2_slowloris.py .

# Install Python dependencies including h2 library for reliable HTTP/2
RUN pip install --no-cache-dir \
    h2 \
    requests \
    && chmod +x http2_slowloris.py

# Create a health check script
RUN echo '#!/bin/bash\necho "HTTP/2 Slowloris Attacker Ready"' > /app/healthcheck.sh \
    && chmod +x /app/healthcheck.sh

# Add labels for documentation
LABEL maintainer="SEED Educational Lab" \
      description="HTTP/2 Slowloris Attack Container - Educational Use Only" \
      version="1.0" \
      lab="slowloris_lab_part_B"

# Set environment variables
ENV PYTHONUNBUFFERED=1
ENV PYTHONDONTWRITEBYTECODE=1

# Health check
HEALTHCHECK --interval=30s --timeout=10s --start-period=5s --retries=3 \
    CMD /app/healthcheck.sh

# Default command - will be overridden in docker-compose
CMD ["python3", "http2_slowloris.py", "--help"]