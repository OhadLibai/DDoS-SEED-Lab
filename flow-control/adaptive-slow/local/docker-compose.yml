services:
  # Apache HTTP Server 2.4.62 - Optimized for Advanced Adaptive Attack
  apache-victim:
    image: httpd:2.4.62
    container_name: apache-adaptive-slow-victim
    ports:
      - "80:80"
    volumes:
      - ../../apache/html:/usr/local/apache2/htdocs
    command: >
      sh -c "sed -i 's/#LoadModule http2_module/LoadModule http2_module/' /usr/local/apache2/conf/httpd.conf &&
             grep -q 'Protocols h2 h2c http/1.1' /usr/local/apache2/conf/httpd.conf || echo 'Protocols h2 h2c http/1.1' >> /usr/local/apache2/conf/httpd.conf &&
             httpd-foreground"
    networks:
      - adaptive-slow-lab
    restart: unless-stopped
    labels:
      - "lab.attack=adaptive-slow"
      - "lab.apache.version=2.4.62"

  # Attacker container
  attacker:
    build: 
      context: ../..
      dockerfile: Dockerfile.attacker
    container_name: adaptive-slow-attacker
    volumes:
      - ../..:/workspace
      - ./logs:/tmp/logs
    networks:
      - adaptive-slow-lab
    depends_on:
      - apache-victim
    environment:
      - PYTHONUNBUFFERED=1
    stdin_open: true
    tty: true

networks:
  adaptive-slow-lab:
    driver: bridge